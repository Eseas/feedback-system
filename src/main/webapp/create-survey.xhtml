<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
>
<f:view>
    <f:metadata>
    </f:metadata>

    <h:head>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"/>
        <link href='https://fonts.googleapis.com/css?family=Roboto:300,400,700' rel='stylesheet' type='text/css'/>
        <link href="https://fonts.googleapis.com/css?family=Josefin+Sans" rel="stylesheet"/>
        <link href="https://fonts.googleapis.com/css?family=Bitter" rel="stylesheet"/>
        <h:outputStylesheet name="css/stylesCreate.css" />
        <title>Builder of Surveys </title>
    </h:head>

    <h:body>

        <ui:include src="/WEB-INF/composites/header.xhtml"/>

        <div class="page_title">
            <h2>Create Survey</h2>
        </div>

        <h:form id="survey-creation-form" >

            <div class="form clearfix">
                <div class="throw-left clearfix">
                    <p:outputLabel for="title" value="Survey name"/>
                    <p:inputText id="title" maxlength="40"  value="#{createSurveyController.survey.title}"
                                placeholder="Survey Name" style="width: 100%;"/>
                    <p:message class="message_error" for="title"/>

                    <p:outputLabel for="description" value="Survey description"/>
                    <p:inputText id="description" maxlength="40" value="#{createSurveyController.survey.description}"
                                 placeholder="Add description..." style="margin-bottom: 30px;"/>
                    <p:message class="message_error" for="description" />
                </div>

                <div class="throw-right clearfix">
                    <p:selectOneButton value="#{createSurveyController.survey.confidential}">
                        <f:selectItem class="button" itemLabel="Private" itemValue="true" />
                        <f:selectItem class="button" itemLabel="Public" itemValue="false" />
                    </p:selectOneButton>
                </div>
            </div>
            <!--<p:messages/>-->

            <p:tabView class="tab_form" id="tab-view" value="#{createSurveyController.survey.sections}" var="section" activeIndex="#{createSurveyController.activeTabIndex}">

                <p:tab id="section-tab" title="Page #{section.position}">
                    <div class="page_description">
                        <p:outputLabel for="section_title" value="Section title"/>
                        <p:inputText maxlength="40" id="section_title" value="#{section.title}" placeholder="Page Name"/>
                        <p:message class="message_error" for="section_title" style="width: 100%;"/>

                        <p:outputLabel for="section_description" value="Description"/>
                        <p:inputText maxlength="40" id="section_description" value="#{section.description}" placeholder="Page description..."/>
                        <p:message class="message_error" for="section_description"/>
                    </div>
                    <hr/>

                        <ui:repeat value="#{createSurveyController.sortQuestionsAscending(section.questions)}" var="question">
                            <p:outputLabel for="questionTitle" value="#{question.getPosition().toString()}"/>
                            <h:inputText id="questionTitle" value="#{question.title}"/>
                            <h:commandButton value="remove" actionListener="#{createSurveyController.removeQuestion(section, question)}"/>
                            <h:commandButton value="up" actionListener="#{createSurveyController.moveUp(section, question)}"/>
                            <h:commandButton value="down" actionListener="#{createSurveyController.moveDown(section, question)}"/>

                            <p:selectOneButton value="#{question.required}">
                                <f:selectItem itemLabel="Required" itemValue="true" />
                                <f:selectItem itemLabel="Optional" itemValue="false" />
                            </p:selectOneButton>
                            <hr/>
                            <br/>

                            <ui:fragment rendered="#{question.type == 'TextQuestion'}">

                            </ui:fragment>

                            <ui:fragment rendered="#{question.type == 'SliderQuestion'}">
                                <p:outputLabel for="lowerBound" value="Lower bound" style="display: inline-block !important"/>
                                <p:inputText id="lowerBound" value="#{question.lowerBound}"/>
                                <p:message for="lowerBound"/>

                                <p:outputLabel for="upperBound" value="Upper bound" style="display: inline-block !important"/>
                                <p:inputText id="upperBound" value="#{question.upperBound}"/>
                                <p:message for="upperBound"/>
                                <hr/>
                            </ui:fragment>

                            <ui:fragment rendered="#{question.type == 'RadioQuestion'}">
                                <h:dataTable value="#{question.radioButtons}" var="radioButton">
                                    <h:column>
                                        <p:outputLabel for="radioButtonTitle" value="Radio Button" style="display: inline-block !important"/>
                                        <h:inputText id="radioButtonTitle" value="#{radioButton.title}" />
                                        <h:commandButton value="remove" action="#{createSurveyController.removeRadioButton(question, radioButton)}"/>
                                        <p:message for="radioButtonTitle"/>
                                    </h:column>
                                </h:dataTable>
                                <h:commandButton value="add radio button" actionListener="#{createSurveyController.addRadioButton(question)}" />
                                <hr/>
                            </ui:fragment>

                            <ui:fragment rendered="#{question.type == 'CheckboxQuestion'}">
                                <h:dataTable value="#{question.checkboxes}" var="checkbox">
                                    <h:column>
                                        <p:outputLabel for="checkboxTitle" value="Checkbox" style="display: inline-block !important"/>
                                        <h:inputText id="checkboxTitle" value="#{checkbox.title}" />
                                        <h:commandButton value="remove" action="#{createSurveyController.removeCheckbox(question, checkbox)}"/>
                                        <p:message for="checkboxTitle"/>
                                    </h:column>
                                </h:dataTable>
                                <h:commandButton value="add option value" actionListener="#{createSurveyController.addCheckbox(question)}" />
                                <hr/>
                            </ui:fragment>

                            <br/>
                            <p:message for="questionTitle"/>
                        </ui:repeat>

                    <div class="adding_question">
                        <p:commandButton value="Add text question" actionListener="#{createSurveyController.addTextQuestion(section)}" update="survey-creation-form"/>
                        <p:commandButton value="Add slider question" actionListener="#{createSurveyController.addSliderQuestion(section)}" update="survey-creation-form" />
                        <p:commandButton value="Add radio question" actionListener="#{createSurveyController.addRadioQuestion(section)}" update="survey-creation-form" />
                        <p:commandButton value="Add checkbox question" actionListener="#{createSurveyController.addCheckboxQuestion(section)}" update="survey-creation-form" />
                    </div>
                    <div class="add_page">
                        <p:commandButton value="Add Page" actionListener="#{createSurveyController.addSection()}" update="survey-creation-form"/>
                    </div>
                </p:tab>


            </p:tabView>

            <div class="cancel_save">
                <h:commandButton class="cancel" value="Cancel" action="index" />
                <h:commandButton class="save" value="Save" action="#{createSurveyController.create()}" />
            </div>
            <p:messages globalOnly="true"/>
        </h:form>
    </h:body>
</f:view>

</html>

