<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:o="http://omnifaces.org/ui"
>
<f:view>
    <f:metadata>
        <f:viewParam name="s" value="#{answerSurveyController.link}"/>
        <f:viewParam name="p" value="#{answerSurveyController.preview}"/>
        <f:viewAction action="#{answerSurveyController.loadData}"/>
    </f:metadata>

    <h:head>
        <meta charset="utf-8"/>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"/>
        <link href='https://fonts.googleapis.com/css?family=Roboto:300,400,700' rel='stylesheet' type='text/css'/>
        <link href="https://fonts.googleapis.com/css?family=Josefin+Sans" rel="stylesheet"/>
        <link href="https://fonts.googleapis.com/css?family=Bitter" rel="stylesheet"/>
        <h:outputStylesheet name="css/stylesAnswer.css" />
        <title>Builder of Surveys</title>
    </h:head>

    <h:body>
        <ui:include src="/WEB-INF/composites/header.xhtml"/>

        <div class="page_title">
            <h2>#{answerSurveyController.answeredSurvey.survey.title}</h2>
        </div>

        <h:outputText class="answ-page-desc" value="#{answerSurveyController.answeredSurvey.survey.description}"/>

            <p:tabView class="tab_form" id="tab-view" value="#{answerSurveyController.answeredSurvey.survey.sections}"
                       var="section" activeIndex="#{answerSurveyController.activeTabIndex}"
                        dynamic="true">

                    <p:tab title="#{section.title}" disabled="true" >
                        <h:outputText value="#{section.description}"/>

                        <h:form id="form">
                        <p:panel>
                            <ui:repeat value="#{section.answers}" var="answer">
                                <p:outputLabel value="#{answer.question.position}. #{answer.question.title}"/>
                                <p:outputLabel rendered="#{answer.question.required}" value="*"/>
                                <br/>

                                <ui:fragment rendered="#{answer.question.type == 'TextQuestion'}">
                                    <p:inputText id="text-value" value="#{answer.value}" disabled="#{answerSurveyController.preview}"
                                                 required="#{empty param.noValidation and answer.question.required}"
                                                 requiredMessage="This is a required question"/>
                                    <p:message for="text-value"/>
                                </ui:fragment>


                                <ui:fragment rendered="#{answer.question.type == 'SliderQuestion'}">
                                    <p:outputLabel value="#{answer.question.lowerBound}..#{answer.question.upperBound}"/>
                                    <p:inputText id="slider-value" value="#{answer.value}" required="#{empty param.noValidation and answer.question.required}"
                                                 requiredMessage="This is a required question"
                                                 disabled="#{answerSurveyController.preview}" />
                                    <p:slider for="slider-value" minValue="#{answer.question.lowerBound}" maxValue="#{answer.question.upperBound}"
                                              disabled="#{answerSurveyController.preview}"/>
                                    <p:message for="slider-value"/>
                                </ui:fragment>

                                <ui:fragment rendered="#{answer.question.type == 'RadioQuestion'}">
                                    <p:selectOneRadio id="select-one-radio" value="#{answer.radioButton}" converter="omnifaces.SelectItemsConverter"
                                                      required="#{empty param.noValidation and answer.question.required}"
                                                      requiredMessage="This is a required question" layout="grid" columns="3"
                                                      disabled="#{answerSurveyController.preview}">
                                        <f:selectItems value="#{answer.question.radioButtons}" var="radioButton" itemLabel="#{radioButton.title}" itemValue="#{radioButton}"/>
                                    </p:selectOneRadio>
                                    <p:message for="select-one-radio"/>
                                </ui:fragment>

                                <ui:fragment rendered="#{answer.question.type == 'CheckboxQuestion'}">
                                    <p:selectManyCheckbox id="select-many-checkbox" value="#{answer.selectedCheckboxes}" converter="omnifaces.SelectItemsConverter"
                                                          required="#{empty param.noValidation and answer.question.required}"
                                                          requiredMessage="This is a required question"
                                                          disabled="#{answerSurveyController.preview}">
                                        <f:selectItems value="#{answerSurveyController.getAvailableSelectedCheckboxes(answer)}" var="availableSelectedCheckbox" itemLabel="#{availableSelectedCheckbox.checkbox.title}" itemValue="#{availableSelectedCheckbox}" />
                                    </p:selectManyCheckbox>
                                    <p:message for="select-many-checkbox"/>
                                </ui:fragment>

                                <br/>
                            </ui:repeat>

                        </p:panel>
                            <ui:fragment id="fragment" rendered="#{!answerSurveyController.firstSection}">
                                <p:commandButton id="previous" value="PREVIOUS" action="#{answerSurveyController.previousTab}" update="tab-view" >
                                    <f:param name="noValidation" value="true"/>
                                </p:commandButton>
                            </ui:fragment>

                            <ui:fragment rendered="#{answerSurveyController.lastSection}">
                                <p:commandButton value="SUBMIT" action="#{answerSurveyController.answer()}"
                                                 update="tab-view"
                                                 disabled="#{answerSurveyController.preview}">
                                    <f:param name="s" value="#{answerSurveyController.link}"/>
                                </p:commandButton>
                            </ui:fragment>

                            <ui:fragment rendered="#{!answerSurveyController.lastSection}">
                                <p:commandButton value="NEXT" action="#{answerSurveyController.nextTab}" update="tab-view" />
                            </ui:fragment>
                        </h:form>
                    </p:tab>


            </p:tabView>

            <p:messages globalOnly="true"/>
        <ui:include src="/WEB-INF/composites/footer.xhtml"/>
    </h:body>
</f:view>

</html>

